{% extends 'layout/base.html' %}
{% load static %}
{% load i18n %}

{% block title %}
Shop
{% endblock title %}

{% block extra_scripts %}

{% endblock extra_scripts %}

{% block content %}

<section class="gird-section">
	<aside class="col">
		<form id="filtersForm">
			<div>
				<span><strong>Categor√≠as</strong></span>
				<ul class="category-list">
					<li class="category-list-item">
						<input type="radio" name="category_id" id="id-radio-all" value="all" {% if not selected_category %} checked {% endif %}>
						<label for="id-radio-all">
							Todos los productos
						</label>
					</li>
					{% for category in categories %}
						<li class="category-list-item">
							<input type="radio" name="category_id" id="id-radio-{{ category.id }}" value="{{ category.id }}" {% if selected_category and category.id == selected_category.id %} checked {% endif %}>
							<label for="id-radio-{{ category.id }}">
								{{ category.name }}
							</label>
						</li>
					{% endfor %}
				</ul>
			</div>
			<div>
				<span><strong>Color</strong></span>
				<div class="color-options">
					{% for color in colors %}
						<div class="color-box" style="background-color: {{ color.name }};"></div>
					{% endfor %}
				</div>
			</div>
			<div class="wrapper">
				<span><strong>Rango de precios</strong></span>
				<div class="price-input">
					<div class="field">
						<span>Min</span>
						<input type="number" class="input-min" value="0">
					</div>
					<div class="separator">
						-
					</div>
					<div class="field">
						<span>Max</span>
						<input type="number" class="input-max" value="10000">
					</div>
				</div>
				<div class="slider">
					<div class="progress"></div>
					<div class="range-input">
						<input type="range" class="range-min" min="0" max="10000" value="0">
						<input type="range" class="range-max" min="0" max="10000" value="10000">
					</div>
				</div>
			</div>
			<input type="submit" value="Filtrar">
		</form>
	</aside>
	<article>
		<h2 class="mb-5">Productos</h2>
		<div class="row">
			{% for product in products %}
			<div class="col-12 col-md-4 col-lg-3 mb-3">
				<a href="{% url 'product' product.id %}" class="product-item" style="view-transition-name: product-{{ product.id }};">
					{% if product.image %}
						<img src="{{ product.image.url }}" alt="{{ product.name }}">
					{% else %}
						<img src="{% static 'images/product-3.png' %}" alt="">
					{% endif %}
					<div class="info pt-3">
						<h4>{{ product.name }}</h4>
						<span>{{ product.color_id.name }}</span>
						<p>${{ product.price }}</p>
					</div>
				</a>
			</div>
			{% endfor %}

			<div class="col-12 text-center">
				<a href="#" class="btn-black-outline">cargar mas</a>
			</div>
		</div>
	</article>
</section>
{% include 'layout/footer.html' %}

{% endblock content %}

{% block inline_javascript %}
<script>
	const rangeInput = document.querySelectorAll('.range-input input'),
	priceInput = document.querySelectorAll('.price-input input');
	const progress = document.querySelector('.slider .progress');
	let priceGap = 1000

	priceInput.forEach(input => {
		input.addEventListener('input', e => {
			let minValue = parseInt(priceInput[0].value),
			maxValue = parseInt(priceInput[1].value);

			if (maxValue - minValue >= priceGap) {
				if (e.target.className === 'input-min') {
					rangeInput[0].value = minValue;
					progress.style.left = (minValue / rangeInput[0].max) * 100 + '%';
				} else {
					rangeInput[1].value = maxValue;
					progress.style.right = 100 -(maxValue / rangeInput[1].max) * 100 + '%';
				}
			}
		})
	});

	rangeInput.forEach(input => {
		input.addEventListener('input', e => {
			let minValue = parseInt(rangeInput[0].value),
			maxValue = parseInt(rangeInput[1].value);

			if (maxValue - minValue < priceGap) {
				if (e.target.className === 'range-min') {
					rangeInput[0].value = maxValue - priceGap;
				} else {
					rangeInput[1].value = minValue + priceGap;
				}
			}
			else {
				priceInput[0].value = minValue;
				priceInput[1].value = maxValue;
				progress.style.left = (minValue / rangeInput[0].max) * 100 + '%';
				progress.style.right = 100 -(maxValue / rangeInput[1].max) * 100 + '%';
			}
		})
	});
</script>
{% endblock inline_javascript %}